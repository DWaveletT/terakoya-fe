import{Y as x,b8 as E,b9 as B,O as d,aB as z,K as V,a0 as _,a1 as o,bg as L,bQ as N,ba as U,bb as b,$ as m,a2 as u,aS as e,a4 as t,a6 as D,aY as I,bn as S,bO as $,ad as v,ac as g,bR as O,ab as R,bh as T,b7 as j,b5 as q}from"./index-C79AFz9e.js";import{C as A,f as F}from"./index-CrwUw-kD.js";import{B as Y}from"./BlockSidebar-Cg-daOVO.js";import{E as c,a as h}from"./index-CnESm0Bb.js";import{E as y}from"./index-ABxyfL3O.js";import"./index-BV-SJpnz.js";import"./strings-CVeockFU.js";const K={class:"main-container"},M={class:"cards"},Q={class:"title",style:{"margin-top":"0"}},G={style:{"font-size":"small"}},H={style:{color:"var(--el-color-info)"}},J={class:"new-post"},W=x({__name:"PostList",setup(X){const k=E(),P=B(),n=d(0),p=N(),r=d(1),i=d({total:0,posts:[]});function w(l){p.push({name:"post.detail",params:{pid:l}})}function C(){n.value>0?p.push({name:"post.new",query:{boardId:n.value}}):p.push({name:"post.new"})}async function f(){await U({url:"http://43.143.171.43:9999/api/post/latest",method:"POST",data:{page:r.value,bid:n.value,token:k.getToken()},withCredentials:!0}).then(l=>{i.value.posts=[],i.value.total=l.data.length,l.data.forEach(s=>{i.value.posts.push(P.conveyPost(s))})}).catch(l=>{let s=l.response;!s||!s.data?b({title:"未知错误",message:"",type:"error"}):b({title:"帖子列表获取失败",message:s.data.message,type:"error"})})}return z(()=>{f()}),V([r,n],()=>{f()}),(l,s)=>(m(),_(L,{bread:[{label:"寺子屋",name:"home"},{label:"帖子列表"}],title:"帖子列表"},{default:o(()=>[u("div",K,[e(t(h),{gutter:20},{default:o(()=>[e(t(c),{span:6},{default:o(()=>[e(Y,{all:!0,modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value=a)},null,8,["modelValue"])]),_:1}),e(t(c),{span:18},{default:o(()=>[e(t(y),{"page-size":20,"pager-count":7,layout:"prev, pager, next",total:i.value.total,background:"","hide-on-single-page":"",small:"",class:"pagination","current-page":r.value,"onUpdate:currentPage":s[1]||(s[1]=a=>r.value=a)},null,8,["total","current-page"]),u("div",M,[(m(!0),D(R,null,I(i.value.posts,a=>(m(),_(t(S),{key:a.id,class:"post-item",onClick:Z=>w(a.id)},{default:o(()=>[e(t(h),{style:{height:"60px"}},{default:o(()=>[e(t(c),{span:4,class:"card-item vertical-middle"},{default:o(()=>[e($,{user:a.poster,size:60},null,8,["user"])]),_:2},1024),e(t(c),{span:8,class:"card-item"},{default:o(()=>[u("h3",Q,v(a.title),1),u("span",G,[e(A,{user:a.poster},null,8,["user"]),g(),u("span",H,[g("发表于 "),e(O,{date:new Date(a.time),placement:"bottom"},null,8,["date"])])])]),_:2},1024),e(t(c),{span:12,class:"card-item describe"},{default:o(()=>[g(v(a.content),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),e(t(y),{"page-size":20,"pager-count":7,layout:"prev, pager, next",total:i.value.total,background:"","hide-on-single-page":"",small:"",class:"pagination","current-page":r.value,"onUpdate:currentPage":s[2]||(s[2]=a=>r.value=a)},null,8,["total","current-page"])]),_:1})]),_:1})]),u("div",J,[e(t(j),{circle:"",size:"large",style:{border:"2px solid var(--el-color-primary)"},onClick:C},{default:o(()=>[e(t(T),{icon:t(F),size:"lg"},null,8,["icon"])]),_:1})])]),_:1}))}}),re=q(W,[["__scopeId","data-v-877ab2aa"]]);export{re as default};
