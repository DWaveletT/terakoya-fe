import{Y as S,$ as c,a6 as y,a2 as s,aS as a,bP as Q,aa as I,ah as X,b5 as T,a0 as b,a1 as n,a4 as l,bo as O,bp as R,bq as z,b6 as Z,b7 as j,O as f,bg as G,aB as H,K as J,bh as W,bX as ee,ab as V,b8 as te,be as w,bf as v,bY as ae,bZ as se,ac as d,bR as $,ae as oe,aY as le,b9 as h,ad as P,b_ as ne,bi as E}from"./index-1gdjFkV8.js";import{C as U,a as re,b as ie,c as ue}from"./index-1MRAUmWn.js";import{_ as L,T as de}from"./TextEditor-D9drGryB.js";import{E as M}from"./index-DqyWa5xP.js";import{a as pe}from"./index-A_prnkOV.js";import{E as x,a as ce}from"./index-BysddClu.js";import"./strings-C0ID7zFz.js";const me={class:"content"},ve={class:"header"},_e={class:"avatar"},fe={class:"message"},ge=S({__name:"CBubble",props:{user:{},borderColor:{default:"var(--el-color-primary)"}},setup(r){const p=r;return(i,g)=>(c(),y("div",me,[s("div",{class:"bubble",style:X({"--border-color":p.borderColor})},[s("div",ve,[s("div",_e,[a(Q,{user:p.user},null,8,["user"])]),I(i.$slots,"header",{},void 0,!0)]),s("div",fe,[I(i.$slots,"message",{},void 0,!0)])],4)]))}}),N=T(ge,[["__scopeId","data-v-f99e24db"]]),A=r=>(R("data-v-e772472f"),r=r(),z(),r),he=A(()=>s("div",{class:"bar-top"},null,-1)),ye=A(()=>s("div",{class:"bar-bottom"},null,-1)),be=S({__name:"CInfoCard",setup(r){return(p,i)=>(c(),b(l(O),{shadow:"never",class:"card"},{default:n(()=>[he,I(p.$slots,"default",{},void 0,!0),ye]),_:3}))}}),Ce=T(be,[["__scopeId","data-v-e772472f"]]),B=r=>(R("data-v-19d13c9f"),r=r(),z(),r),ke=B(()=>s("div",{class:"reply-operator"}," 楼主 ",-1)),we=B(()=>s("h3",{style:{margin:"0"}},"回复帖子",-1)),$e=B(()=>s("span",{class:"please-login"},"请先登录",-1)),Pe=[$e],Ee={class:"reply-buttons"},xe={class:"aside"},Ie={style:{margin:"0.5em","text-align":"center"}},Se={class:"info"},Te={class:"info-item"},Be={class:"info-item"},De={class:"info-item"},Ve={class:"post-operator"},Ue=S({__name:"PostDetail",setup(r){const p=Z(),i=j(),g=te(),C=f(!1),D=f(null),_=f("");function Y(){D.value.scrollIntoView()}G();const o=f({post:i.fakePost,replys:[],total:100}),m=f(i.parseQueryInt("page")||1);async function k(){let u=i.parseParamInt("pid");if(u===void 0){o.value={post:i.nonePost,replys:[],total:0};return}await w({url:`http://43.143.171.43:9999/api/post/${u}`,method:"POST",data:{page:m.value},withCredentials:!0}).then(e=>{console.log(e.data),o.value.post=i.conveyPost(e.data.post),o.value.replys=[],o.value.total=e.data.replies.length,e.data.replies.forEach(t=>{o.value.replys.push(i.conveyReply(t))})}).catch(e=>{let t=e.response;!t||!t.data?v({title:"未知错误",message:"",type:"error"}):v({title:"帖子内容获取失败",message:t.data.message,type:"error"}),o.value={post:i.nonePost,replys:[],total:0}})}async function q(){w({url:"http://43.143.171.43:9999/api/post/delete",method:"POST",data:{pid:o.value.post.id,token:p.getToken()},withCredentials:!0}).then(u=>{x({type:"success",message:"删除成功"}),g.push("/post")}).catch(u=>{var t;let e=u.response;!e||!e.data?v({title:"未知错误",message:"",type:"error"}):(v({title:"删除失败",message:e.data.message,type:"error"}),((t=u.response)==null?void 0:t.status)===401&&g.push({name:"login"}))})}function F(){w({url:"http://43.143.171.43:9999/api/reply/create",method:"POST",data:{pid:o.value.post.id,content:_.value,token:p.getToken()},withCredentials:!0}).then(u=>{x({type:"success",message:"回复成功"}),_.value="",k()}).catch(u=>{var t;let e=u.response;!e||!e.data?v({title:"未知错误",message:"",type:"error"}):(v({title:"回复失败",message:e.data.message,type:"error"}),((t=u.response)==null?void 0:t.status)===401&&g.push({name:"login"}))})}function K(){ce.confirm("确定要删除吗？","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{q()}).catch(()=>{x({type:"info",message:"删除取消"})})}return H(()=>{k()}),J(m,()=>{k()}),(u,e)=>(c(),y(V,null,[a(W,{title:o.value.post.title,bread:[{label:"寺子屋",name:"home"},{label:"帖子列表",name:"post.list"},{label:"讨论详情"}]},{default:n(()=>[a(l(ae),{class:"main-container"},{default:n(()=>[a(l(se),{class:"main"},{default:n(()=>[a(N,{user:o.value.post.poster,"border-color":"var(--el-color-warning)"},{header:n(()=>[a(U,{user:o.value.post.poster},null,8,["user"]),d(" / "),a($,{date:new Date(o.value.post.time)},null,8,["date"]),ke]),message:n(()=>[a(L,{content:o.value.post.content},null,8,["content"])]),_:1},8,["user"]),o.value.replys.length>5?(c(),b(l(M),{key:0,"page-size":50,"pager-count":7,layout:"prev, pager, next",total:o.value.total,background:"","hide-on-single-page":"",small:"",class:"pagination","current-page":m.value,"onUpdate:currentPage":e[0]||(e[0]=t=>m.value=t)},null,8,["total","current-page"])):oe("",!0),(c(!0),y(V,null,le(o.value.replys,t=>(c(),b(N,{key:t.id,user:t.replyer},{header:n(()=>[a(U,{user:t.replyer},null,8,["user"]),d(" / "),a($,{date:new Date(t.time)},null,8,["date"])]),message:n(()=>[a(L,{content:t.content},null,8,["content"])]),_:2},1032,["user"]))),128)),a(l(M),{hideOnSinglePage:"","page-size":50,"pager-count":7,layout:"prev, pager, next",total:o.value.total,background:"",small:"",class:"pagination","current-page":m.value,"onUpdate:currentPage":e[1]||(e[1]=t=>m.value=t)},null,8,["total","current-page"]),s("div",{ref_key:"reply",ref:D},null,512),a(l(O),{shadow:"hover"},{default:n(()=>[we,l(p).getLogin()?(c(),b(de,{key:0,modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=t=>_.value=t),placeholder:"请在此处回复，支持使用 Markdown。"},null,8,["modelValue"])):(c(),y("div",{key:1,class:"login-area",onClick:e[3]||(e[3]=t=>C.value=!0)},Pe)),s("div",Ee,[a(l(h),{type:"danger",plain:"",onClick:e[4]||(e[4]=t=>_.value="")},{default:n(()=>[d("清除")]),_:1}),a(l(h),{type:"primary",onClick:F},{default:n(()=>[d("回复")]),_:1})])]),_:1})]),_:1}),s("aside",xe,[a(l(pe),{offset:30},{default:n(()=>[a(Ce,null,{default:n(()=>[s("h3",Ie,P(o.value.post.title),1),a(l(ne)),s("div",Se,[s("div",Te,[s("div",null,[a(l(E),{icon:l(re)},null,8,["icon"]),d(" 楼主")]),s("div",null,P(o.value.post.poster.name),1)]),s("div",Be,[s("div",null,[a(l(E),{icon:l(ie)},null,8,["icon"]),d(" 发布时间")]),a($,{date:new Date(o.value.post.time),type:"detail"},null,8,["date"])]),s("div",De,[s("div",null,[a(l(E),{icon:l(ue)},null,8,["icon"]),d(" 回复个数")]),s("div",null,P(o.value.total),1)])])]),_:1}),s("div",Ve,[s("div",null,[a(l(h),{type:"primary",plain:"",onClick:Y},{default:n(()=>[d("回复")]),_:1}),a(l(h),{type:"danger",plain:"",onClick:K},{default:n(()=>[d("删除")]),_:1})])])]),_:1})])]),_:1})]),_:1},8,["title"]),a(ee,{modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=t=>C.value=t)},null,8,["modelValue"])],64))}}),Ye=T(Ue,[["__scopeId","data-v-19d13c9f"]]);export{Ye as default};
