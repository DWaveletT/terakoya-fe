import{Y as x,b6 as E,b7 as B,O as d,aB as z,K as V,a0 as _,a1 as o,bh as L,b8 as N,be as U,bf as v,$ as m,a2 as u,aS as e,a4 as t,a6 as D,aY as I,bo as S,bP as $,ad as b,ac as f,bR as R,ab as T,bi as j,b9 as q,b5 as A}from"./index-1gdjFkV8.js";import{C as F,f as O}from"./index-1MRAUmWn.js";import{B as Y}from"./BlockSidebar-DP7hOFFD.js";import{E as c,a as h}from"./index-Ci-xJzpj.js";import{E as y}from"./index-DqyWa5xP.js";import"./config-CUFdrsHO.js";import"./index-A_prnkOV.js";import"./strings-C0ID7zFz.js";const K={class:"main-container"},M={class:"cards"},G={class:"title",style:{"margin-top":"0"}},H={style:{"font-size":"small"}},J={style:{color:"var(--el-color-info)"}},Q={class:"new-post"},W=x({__name:"PostList",setup(X){const P=E(),k=B(),n=d(0),p=N(),r=d(1),i=d({total:0,posts:[]});function w(l){p.push({name:"post.detail",params:{pid:l}})}function C(){n.value>0?p.push({name:"post.new",query:{boardId:n.value}}):p.push({name:"post.new"})}async function g(){await U({url:"http://43.143.171.43:9999/api/post/latest",method:"POST",data:{page:r.value,bid:n.value,token:P.getToken()},withCredentials:!0}).then(l=>{i.value.posts=[],i.value.total=l.data.length,l.data.forEach(s=>{i.value.posts.push(k.conveyPost(s))})}).catch(l=>{let s=l.response;!s||!s.data?v({title:"未知错误",message:"",type:"error"}):(v({title:"帖子列表获取失败",message:s.data.message,type:"error"}),l.status===401&&p.push({name:"login"}))})}return z(()=>{g()}),V([r,n],()=>{g()}),(l,s)=>(m(),_(L,{bread:[{label:"寺子屋",name:"home"},{label:"帖子列表"}],title:"帖子列表"},{default:o(()=>[u("div",K,[e(t(h),{gutter:20},{default:o(()=>[e(t(c),{span:6},{default:o(()=>[e(Y,{all:!0,modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value=a)},null,8,["modelValue"])]),_:1}),e(t(c),{span:18},{default:o(()=>[e(t(y),{"page-size":20,"pager-count":7,layout:"prev, pager, next",total:i.value.total,background:"","hide-on-single-page":"",small:"",class:"pagination","current-page":r.value,"onUpdate:currentPage":s[1]||(s[1]=a=>r.value=a)},null,8,["total","current-page"]),u("div",M,[(m(!0),D(T,null,I(i.value.posts,a=>(m(),_(t(S),{key:a.id,class:"post-item",onClick:Z=>w(a.id)},{default:o(()=>[e(t(h),{style:{height:"60px"}},{default:o(()=>[e(t(c),{span:4,class:"card-item vertical-middle"},{default:o(()=>[e($,{user:a.poster,size:60},null,8,["user"])]),_:2},1024),e(t(c),{span:8,class:"card-item"},{default:o(()=>[u("h3",G,b(a.title),1),u("span",H,[e(F,{user:a.poster},null,8,["user"]),f(),u("span",J,[f("发表于 "),e(R,{date:new Date(a.time),placement:"bottom"},null,8,["date"])])])]),_:2},1024),e(t(c),{span:12,class:"card-item describe"},{default:o(()=>[f(b(a.content),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),e(t(y),{"page-size":20,"pager-count":7,layout:"prev, pager, next",total:i.value.total,background:"","hide-on-single-page":"",small:"",class:"pagination","current-page":r.value,"onUpdate:currentPage":s[2]||(s[2]=a=>r.value=a)},null,8,["total","current-page"])]),_:1})]),_:1})]),u("div",Q,[e(t(q),{circle:"",size:"large",style:{border:"2px solid var(--el-color-primary)"},onClick:C},{default:o(()=>[e(t(j),{icon:t(O),size:"lg"},null,8,["icon"])]),_:1})])]),_:1}))}}),ie=A(W,[["__scopeId","data-v-4fd88d90"]]);export{ie as default};
