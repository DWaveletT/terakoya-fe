import{Y as P,$ as d,a6 as f,a2 as t,aS as e,bO as M,aa as w,ah as Y,b5 as E,a0 as g,a1 as n,a4 as l,bn as N,bo as O,bp as R,b8 as Q,b9 as j,O as v,b6 as q,aB as K,K as X,bg as Z,bX as G,ab as S,bQ as H,F as J,ba as W,bb as V,bY as ee,bZ as te,ac as u,bR as C,ae,aY as se,b7 as m,ad as $,b_ as oe,bh as k}from"./index-Cb2PR_UR.js";import{C as B,a as le,b as ne,c as re}from"./index-CC5obEvw.js";import{_ as T,T as ie}from"./TextEditor-jhmQWRGE.js";import{E as U}from"./index-TVYHdxP5.js";import{a as ue}from"./index-NhRZgnkf.js";import"./strings-DDtZfTri.js";const de={class:"content"},pe={class:"header"},ce={class:"avatar"},ve={class:"message"},_e=P({__name:"CBubble",props:{user:{},borderColor:{default:"var(--el-color-primary)"}},setup(r){const p=r;return(i,_)=>(d(),f("div",de,[t("div",{class:"bubble",style:Y({"--border-color":p.borderColor})},[t("div",pe,[t("div",ce,[e(M,{user:p.user},null,8,["user"])]),w(i.$slots,"header",{},void 0,!0)]),t("div",ve,[w(i.$slots,"message",{},void 0,!0)])],4)]))}}),L=E(_e,[["__scopeId","data-v-f99e24db"]]),z=r=>(O("data-v-e772472f"),r=r(),R(),r),me=z(()=>t("div",{class:"bar-top"},null,-1)),fe=z(()=>t("div",{class:"bar-bottom"},null,-1)),ge=P({__name:"CInfoCard",setup(r){return(p,i)=>(d(),g(l(N),{shadow:"never",class:"card"},{default:n(()=>[me,w(p.$slots,"default",{},void 0,!0),fe]),_:3}))}}),be=E(ge,[["__scopeId","data-v-e772472f"]]),I=r=>(O("data-v-d002e8fb"),r=r(),R(),r),ye=I(()=>t("div",{class:"reply-operator"}," 楼主 ",-1)),he=I(()=>t("h3",{style:{margin:"0"}},"回复帖子",-1)),Ce=I(()=>t("span",{class:"please-login"},"请先登录",-1)),$e=[Ce],ke={class:"reply-buttons"},we={class:"aside"},Pe={style:{margin:"0.5em","text-align":"center"}},Ee={class:"info"},Ie={class:"info-item"},xe={class:"info-item"},De={class:"info-item"},Se={class:"post-operator"},Ve=P({__name:"PostDetail",setup(r){const p=Q(),i=j();H();const _=v(!1),x=v(null),b=v(""),y=J("scrollbar-wrap");function A(){y==null||y.scrollTo({top:x.value.offsetTop-10,behavior:"smooth"})}q();const s=v({post:i.fakePost,replys:[],total:100}),c=v(i.parseQueryInt("page")||1);async function D(){let h=i.parseParamInt("pid");if(h===void 0){s.value={post:i.nonePost,replys:[],total:0};return}await W({url:`http://43.143.171.43:9999/api/post/${h}`,method:"POST",data:{page:c.value},withCredentials:!0}).then(o=>{console.log(o.data),s.value.post=i.conveyPost(o.data.post),s.value.replys=[],s.value.total=o.data.replies.length,o.data.replies.forEach(a=>{s.value.replys.push(i.conveyReply(a))})}).catch(o=>{let a=o.response;!a||!a.data?V({title:"未知错误",message:"",type:"error"}):V({title:"帖子内容获取失败",message:a.data.message,type:"error"}),s.value={post:i.nonePost,replys:[],total:0}})}function F(){console.log("do post delete")}return K(()=>{D()}),X(c,()=>{D()}),(h,o)=>(d(),f(S,null,[e(Z,{title:s.value.post.title,bread:[{label:"寺子屋",name:"home"},{label:"帖子列表",name:"post.list"},{label:"讨论详情"}]},{default:n(()=>[e(l(ee),{class:"main-container"},{default:n(()=>[e(l(te),{class:"main"},{default:n(()=>[e(L,{user:s.value.post.poster,"border-color":"var(--el-color-warning)"},{header:n(()=>[e(B,{user:s.value.post.poster},null,8,["user"]),u(" / "),e(C,{date:new Date(s.value.post.time)},null,8,["date"]),ye]),message:n(()=>[e(T,{content:s.value.post.content},null,8,["content"])]),_:1},8,["user"]),s.value.replys.length>5?(d(),g(l(U),{key:0,"page-size":50,"pager-count":7,layout:"prev, pager, next",total:s.value.total,background:"","hide-on-single-page":"",small:"",class:"pagination","current-page":c.value,"onUpdate:currentPage":o[0]||(o[0]=a=>c.value=a)},null,8,["total","current-page"])):ae("",!0),(d(!0),f(S,null,se(s.value.replys,a=>(d(),g(L,{key:a.id,user:a.replyer},{header:n(()=>[e(B,{user:a.replyer},null,8,["user"]),u(" / "),e(C,{date:new Date(a.time)},null,8,["date"])]),message:n(()=>[e(T,{content:a.content},null,8,["content"])]),_:2},1032,["user"]))),128)),e(l(U),{hideOnSinglePage:"","page-size":50,"pager-count":7,layout:"prev, pager, next",total:s.value.total,background:"",small:"",class:"pagination","current-page":c.value,"onUpdate:currentPage":o[1]||(o[1]=a=>c.value=a)},null,8,["total","current-page"]),t("div",{ref_key:"reply",ref:x},null,512),e(l(N),{shadow:"hover"},{default:n(()=>[he,l(p).getLogin()?(d(),g(ie,{key:0,modelValue:b.value,"onUpdate:modelValue":o[2]||(o[2]=a=>b.value=a),placeholder:"请在此处回复，支持使用 Markdown。"},null,8,["modelValue"])):(d(),f("div",{key:1,class:"login-area",onClick:o[3]||(o[3]=a=>_.value=!0)},$e)),t("div",ke,[e(l(m),{type:"danger",plain:"",onClick:o[4]||(o[4]=a=>b.value="")},{default:n(()=>[u("清除")]),_:1}),e(l(m),{type:"primary"},{default:n(()=>[u("回复")]),_:1})])]),_:1})]),_:1}),t("aside",we,[e(l(ue),{offset:30},{default:n(()=>[e(be,null,{default:n(()=>[t("h3",Pe,$(s.value.post.title),1),e(l(oe)),t("div",Ee,[t("div",Ie,[t("div",null,[e(l(k),{icon:l(le)},null,8,["icon"]),u(" 楼主")]),t("div",null,$(s.value.post.poster.name),1)]),t("div",xe,[t("div",null,[e(l(k),{icon:l(ne)},null,8,["icon"]),u(" 发布时间")]),e(C,{date:new Date(s.value.post.time),type:"detail"},null,8,["date"])]),t("div",De,[t("div",null,[e(l(k),{icon:l(re)},null,8,["icon"]),u(" 回复个数")]),t("div",null,$(s.value.total),1)])])]),_:1}),t("div",Se,[t("div",null,[e(l(m),{type:"primary",plain:"",onClick:A},{default:n(()=>[u("回复")]),_:1}),e(l(m),{type:"danger",plain:"",onClick:F},{default:n(()=>[u("删除")]),_:1})])])]),_:1})])]),_:1})]),_:1},8,["title"]),e(G,{modelValue:_.value,"onUpdate:modelValue":o[5]||(o[5]=a=>_.value=a)},null,8,["modelValue"])],64))}}),Re=E(Ve,[["__scopeId","data-v-d002e8fb"]]);export{Re as default};
